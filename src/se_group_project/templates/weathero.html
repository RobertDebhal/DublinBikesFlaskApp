<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <title>
		dasfsdfsdfgsdfTeamForSoft
	</title>
 <!--   <link rel="stylesheet" type="text/css" href="style.css"/> -->
 
</head>
<body id="body">
	

    <br> <br><br>
	<div id="map" style="width:100%;height:400px"></div>
	<!--http://biostall.com/loading-infowindow-content-using-ajax-with-google-maps-api/-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
	<script>
		var lastOpenedInfoWindow;
		var parsedObj;
		
		function myMap() {
 // https://www.w3schools.com/js/js_json_http.asp
             function checkNumbers(url) {
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			parsedObj = JSON.parse(this.responseText);
            myFunction(parsedObj);
			
		}
	};
	xmlhttp.open("GET", url, true);
	xmlhttp.send();
             }
            
            
        function myFunction(arr) {
      
			var mapOptions = {
				center: new google.maps.LatLng(53.350140, -6.266155),
				zoom: 14,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			}
		var map = new google.maps.Map(document.getElementById("map"), mapOptions);
        var i;
         for(i = 0; i < arr.length; i++){
            var cityCircle = new google.maps.Circle({
                strokeColor: '#0000FF',
                strokeOpacity: 0.8,
                strokeWeight: 0.5,
                fillColor: '#0000FF',
                fillOpacity: 0.35,
                map: map,
                center:{lat:arr[i].lat,lng:arr[i].lng},
                position: {lat:arr[i].lat,lng:arr[i].lng},
                radius: 50,
				number: arr[i].number
            });
            var contentString = '<div>'+ '<div> '+ arr[i].name +' </div>'+ '<div>'+ '</div>' +'</div>';
            
            var infowindow = new google.maps.InfoWindow();
            var num = cityCircle.number;
           google.maps.event.addListener(cityCircle,'click',(function( cityCircle,contentString,infowindow) {
               return function(){
				   $.ajax({  
                url: "http://localhost:5000/available/"+cityCircle.number,  
                success: function(data) { 
                        infowindow.setContent(data[0].available_bikes+"");  
						infowindow.open(map, cityCircle); 
						closeLastOpenedInfoWindow();
						lastOpenedInfoWindow = infowindow; 
                }  
            });
          
               };
        })(cityCircle,contentString,infowindow)); 
        }
    
        function closeLastOpenedInfoWindow(){
			if (lastOpenedInfoWindow) {
        lastOpenedInfoWindow.close();
    }
}
        
        }        
			
			
                checkNumbers("http://localhost:5000/orlaJSON");
				
			//	checkNumbers("http://localhost:5000/available/"+i;);
		
		
	}	
		
	
		
		
		
		
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?callback=myMap&key=AIzaSyDnhjzNlsrZqK3A_HtAfH0ya2hmN0qQAzs"></script>
	

	<button onclick=" myMap()">Click me</button>
	
	
    <br>
    <br> <br> <br>   <br>  <br>

    <div id="/test">
        <div class="footer">
			
       <!--     <footer class="copyright" > '{{ name | tojson | safe}}'</footer> -->
        </div>
     </div>
    </body>
</html>
